<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja" dir="ltr">
<head>
	<title>日本PHPユーザ会 掲示板: PHP 5 &raquo; 任意のファイルをダウロードするスクリプト</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="description" content="日本PHPユーザ会運営の掲示板です。※ただいまテスト運用中です。" />
	<meta name="keywords" content="php,web,php.gr.jp,community,usebb" />
	<link rel="stylesheet" type="text/css" href="./templates/phpgrjp0.3/styles.css" />
	<link rel="shortcut icon" href="./templates/phpgrjp0.3/gfx/usebb.ico" />
	<link rel="alternate" type="application/rss+xml" title="日本PHPユーザ会 掲示板 RSS フィード" href="rss.xml" />
	<script type="text/javascript" src="sources/javascript.js"></script>
</head>
<body onload="javascript:init_external()">
	<div id="pagebox-bg">
	<div id="shadow-left">
	<div id="shadow-right">
	
	<p id="logo"><a href="index.html"><img src="./templates/phpgrjp0.3/gfx/usebb.png" alt="UseBB" title="ホーム" /></a></p>
	<h1 id="boardname"><span id="line">日本PHPユーザ会 掲示板</span></h1>
	<h2 id="boarddescr">日本PHPユーザ会運営の掲示板です。※ただいまテスト運用中です。</h2>
	
	<div id="topmenu"><ul>
		<li><a href="index.html">ホーム</a></li><li><a href="panel-register.html">登録</a></li><li><a href="faq.html">FAQ</a></li><li><a href="search.html">検索</a></li><li><a href="active.html">活発なトピック</a></li><li><a href="panel-login.html">ログイン</a></li>
	</ul></div>
	<div id="topmenu-shadow"></div>
	
	<p class="locationbar">
		&bull; <a href="index.html">日本PHPユーザ会 掲示板</a> &raquo; <a href="forum-4.html">PHP 5</a> &raquo; 任意のファイルをダウロードするスクリプト
	</p>

	<h3 id="forumname"><a href="topic-170.html">任意のファイルをダウロードするスクリプト</a></h3>
	<p id="forummods"></p>
	<p id="toolbartop"> </p>
	<p id="pagelinkstop">ページ: 1</p>
	<table class="maintable">
		<tr>
			<th>投稿者</th>
			<th>投稿</th>
		</tr>

		<tr class="tr1">
			<td class="postername">
				<div class="posternamecontainer"><a href="profile-265.html">yoshiyan</a></div>
			</td>
			<td class="postinfo">
				<div class="postlinks"></div>
				<div class="postdate"><a href="topic-post458.html#post458" name="post458" rel="nofollow">#1</a> 2009 年 10 月 24 日(土) 20:11</div>
			</td>
		</tr>
		<tr class="tr1">
			<td class="posterinfo">
				会員
				<div class="avatar"></div>
				<div class="field">登録者: 10 2009</div>
				<div class="field">返信数: 3</div>
				<div class="field"></div>
			</td>
			<td class="postcontent">
				<div class="post">phpで任意のファイルをダウンロードさせる<br /><br />HTML側<br />&lt;html&gt;<br />&lt;head&gt;<br />&lt;title&gt;&lt;/title&gt;<br />&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;<br />&lt;/head&gt;<br />&lt;body&gt; <br />&lt;a href=&quot;download/down.php?mode=moon.wav&quot;&gt;moon.wav&lt;/a&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;<br /><br /><br /><br />down.php側<br />&lt;?php<br />&#36;path_file = &#36;_GET[&quot;mode&quot;];<br />function download_file(&#36;path_file)<br />&#123;<br /><br />    /* ダウンロード用のHTTPヘッダ送信 */<br />    header(&quot;Content-Disposition: inline; filename=\&quot;&quot;.basename(&#36;path_file).&quot;\&quot;&quot;);<br />    header(&quot;Content-Length: &quot;.&#36;content_length);<br />    header(&quot;Content-Type: application/octet-stream&quot;);<br /><br />    /* ファイルを読んで出力 */<br />    if (!readfile(&#36;path_file)) &#123;<br />        die(&quot;Cannot read the file(&quot;.&#36;path_file.&quot;)&quot;);<br />    &#125;<br />&#125;<br />?&gt;<br /><br />ダウンロードダイアログも現れない。<br />プログレスバーも表示なし。<br />ダウンロードダイアログを開いてくれません。<br /><br />ここでハマッテいます。<br />何方か、ご指導お願いします。</div>
			</td>
		</tr>

		<tr class="tr2">
			<td class="postername">
				<div class="posternamecontainer"><a href="profile-245.html">joy</a></div>
			</td>
			<td class="postinfo">
				<div class="postlinks"></div>
				<div class="postdate"><a href="topic-post459.html#post459" name="post459" rel="nofollow">#2</a> 2009 年 10 月 24 日(土) 23:39</div>
			</td>
		</tr>
		<tr class="tr2">
			<td class="posterinfo">
				会員
				<div class="avatar"></div>
				<div class="field">登録者: 8 2009</div>
				<div class="field">返信数: 5</div>
				<div class="field"></div>
			</td>
			<td class="postcontent">
				<div class="post">yoshiyanさん、<br />最もシンプルな、html、php、指定ファイルが、全て、同一階層におかれた例です。<br />HTML側:download.html<br /><pre class="code"><br />&lt;html&gt;<br />&lt;head&gt;<br />&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;<br />&lt;title&gt;指定ファイルをダウンロード&lt;/title&gt;<br />&lt;/head&gt;<br />&lt;body&gt;<br />ファイル名を指定ください<br />&lt;form method=&quot;POST&quot; action=&quot;download.php&quot;&gt;<br />	&lt;input type=&quot;text&quot; name=&quot;name&quot; size=&quot;15&quot;/&gt;&lt;br/&gt;<br />	&lt;input type=&quot;submit&quot; value=&quot;DownLoad&quot;/&gt;<br />&lt;/form&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;<br /></pre><br />PHP側：download.php<br /><pre class="code"><br />&lt;?php<br />&#36;fileName=&#36;_POST['name'];<br />if(file_exists(&#36;fileName))&#123;//指定ファイルが存在するかどうかをチェックし、trueなら、以下を処理するが、<br />	&#36;fileSize = filesize(&#36;fileName);<br />	&#36;mime = 'application/octet-stream'; // MIMEタイプが何にでも対応できるよう	<br />	header('Content-Type: &quot;' . &#36;mime . '&quot;');<br />	header('Content-Disposition: attachment; filename=&quot;' . &#36;fileName . '&quot;');<br />	header('Content-Transfer-Encoding: binary');<br />	header('Expires: 0');<br />	if(strstr(&#36;_SERVER['HTTP_USER_AGENT'], 'MSIE')) &#123;//ブラウザーが、MSIEならば、<br />	  header('Cache-Control: must-revalidate, post-check=0, pre-check=0');//キャッシュ化無効<br />	  header('Pragma: public');<br />	&#125; else &#123;//その他のブラザーなら、<br />	  header('Pragma: no-cache');<br />	&#125;<br />	header('Content-Length: ' . &#36;fileSize);<br />	readfile(&#36;fileName);<br />&#125;else&#123;//falseなら、メッセージを表示<br />	print ('指定ファイルは、存在しません。');<br />&#125;</pre><br />でどうでしょうか？<div class="editinfo">&laquo; 最終編集者 <a href="profile-245.html">joy</a> 日時 2009 年 10 月 24 日(土) 23:58. &raquo;</div></div>
			</td>
		</tr>

		<tr class="tr1">
			<td class="postername">
				<div class="posternamecontainer"><a href="profile-265.html">yoshiyan</a></div>
			</td>
			<td class="postinfo">
				<div class="postlinks"></div>
				<div class="postdate"><a href="topic-post460.html#post460" name="post460" rel="nofollow">#3</a> 2009 年 10 月 25 日(日) 8:42</div>
			</td>
		</tr>
		<tr class="tr1">
			<td class="posterinfo">
				会員
				<div class="avatar"></div>
				<div class="field">登録者: 10 2009</div>
				<div class="field">返信数: 3</div>
				<div class="field"></div>
			</td>
			<td class="postcontent">
				<div class="post">駄目ででした。<br />Warning: Cannot modify header information - headers already sent by (output started at G:\home\homedoc\htdocs\down\down.php:2) in G:\home\homedoc\htdocs\down\down.php on line 10<br /><br />Warning: Cannot modify header information - headers already sent by (output started at G:\home\homedoc\htdocs\down\down.php:2) in G:\home\homedoc\htdocs\down\down.php on line 11<br /><br />Warning: Cannot modify header information - headers already sent by (output started at G:\home\homedoc\htdocs\down\down.php:2) in G:\home\homedoc\htdocs\down\down.php on line 12<br /><br />Warning: Cannot modify header information - headers already sent by (output started at G:\home\homedoc\htdocs\down\down.php:2) in G:\home\homedoc\htdocs\down\down.php on line 13<br /><br />Warning: Cannot modify header information - headers already sent by (output started at G:\home\homedoc\htdocs\down\down.php:2) in G:\home\homedoc\htdocs\down\down.php on line 15<br /><br />Warning: Cannot modify header information - headers already sent by (output started at G:\home\homedoc\htdocs\down\down.php:2) in G:\home\homedoc\htdocs\down\down.php on line 16<br /><br />Warning: Cannot modify header information - headers already sent by (output started at G:\home\homedoc\htdocs\down\down.php:2) in G:\home\homedoc\htdocs\down\down.php on line 20<br />RIFF?XWAVEfmt <br /><br />エラー番号からするとheaderのエラーのようです。<br /><br /><br />1ウンロードダイアログも現れません。<br />2.プログレスバーが動きません。<br />3.ブラウザがダウンロードダイアログを開いてくれません。<br />4.ファイルも落とせないです。<br /><br />ターゲットブラウザは、IE8です。<br /><br />&lt;a href=&quot;download.php?mode=moon.wav&quot;&gt;moon.csvをダウンロードする&lt;/a&gt;<br /><br />//sample.php<br />&lt;?php<br />   &#36;file = S_GET[&quot;mode&quot;];<br />   &#36;file_length = filesize(&#36;file);<br />   header(&quot;Content-Disposition: attachment; filename=&#36;file&quot;);<br />   header(&quot;Content-Length:&#36;file_length&quot;);<br />   header(&quot;Content-Type: application/octet-stream&quot;);<br />   readfile (&#36;file);<br />?&gt;<br /><br />こなのを考えてみました。<br />駄目ででした。<br />エラーは、出ないもののheaderが動作しません。<br />1ウンロードダイアログも現れません。<br />2.プログレスバーが動きます。<br />3.ブラウザがダウンロードダイアログを開いてくれません。<br />おまけに、ファイルの中身を表示してします・・・・？？？？<br /><br />まったく進展なしです。<div class="editinfo">&laquo; 最終編集者 <a href="profile-2.html" class="administrator">ELF</a> 日時 2009 年 10 月 26 日(月) 10:35. &raquo;</div></div>
			</td>
		</tr>

		<tr class="tr2">
			<td class="postername">
				<div class="posternamecontainer"><a href="profile-245.html">joy</a></div>
			</td>
			<td class="postinfo">
				<div class="postlinks"></div>
				<div class="postdate"><a href="topic-post461.html#post461" name="post461" rel="nofollow">#4</a> 2009 年 10 月 25 日(日) 18:17</div>
			</td>
		</tr>
		<tr class="tr2">
			<td class="posterinfo">
				会員
				<div class="avatar"></div>
				<div class="field">登録者: 8 2009</div>
				<div class="field">返信数: 5</div>
				<div class="field"></div>
			</td>
			<td class="postcontent">
				<div class="post">yoshiyanさん、<br />そうですか？<br />以下、@pagesのサーバーにアップしましたが、downloadできますが・・・<br /><a href="http://www16.atpages.jp/joyko/answers/download/download.html" title="http://www16.atpages.jp/joyko/answers/download/download.html" rel="external">ダウンロードのhtmlページです</a><br /><br />まずは、ご自分の手を加える前に、私のscript（上のように、一応、動いているので）そのもので、試してみて、それから、ご自分のおやりになりたいように、されたらいかがでしょうか？</div>
			</td>
		</tr>

		<tr class="tr1">
			<td class="postername">
				<div class="posternamecontainer"><a href="profile-265.html">yoshiyan</a></div>
			</td>
			<td class="postinfo">
				<div class="postlinks"></div>
				<div class="postdate"><a href="topic-post462.html#post462" name="post462" rel="nofollow">#5</a> 2009 年 10 月 25 日(日) 19:13</div>
			</td>
		</tr>
		<tr class="tr1">
			<td class="posterinfo">
				会員
				<div class="avatar"></div>
				<div class="field">登録者: 10 2009</div>
				<div class="field">返信数: 3</div>
				<div class="field"></div>
			</td>
			<td class="postcontent">
				<div class="post">今、HPの方を拝見しました。<br />ちゃんと、動作しています。<br />確認、しました。<br /><br />このHPっていつ迄公開していますか？？<br />可能ならば、暫く公開していて欲しいのですが、可能でしょうか。？？<br /><br />質問なんですが、この公開されているSeverは、何でしょうか。？？<br />私の環境は、Vine　Linux　Sever5.0を使用しています。<br />Unicodeの違いは、関係ないでしょうか。<br />私の方は、Unicode　UTF-8　改行コードがLFです。<br />コードがUNIXです。<br /><br />もしかしてUnicode　UTF-8N 改行コードがCRLFで動作しているのでは、ないでしょうか？？<br />若しくは、Unicode　UTF-8N　改行コードCRだと思うのですが・・・・<br />違ってたらごめんなさいです。<br /><br />改行コードの違いかも、Unicode　UTF-8N 改行コードがCRLF<br />なら私の書いた最初のProgramでも動作します。<br /><span style="color:red"><strong>Unicode　UTF-8 改行コードがLF</strong></span><br />最初に書き込みすべき事でした。<br />これが、原因でハマっています。<div class="editinfo">&laquo; 最終編集者 <a href="profile-265.html">yoshiyan</a> 日時 2009 年 10 月 25 日(日) 20:24. &raquo;</div></div>
			</td>
		</tr>

		<tr class="tr2">
			<td class="postername">
				<div class="posternamecontainer"><a href="profile-245.html">joy</a></div>
			</td>
			<td class="postinfo">
				<div class="postlinks"></div>
				<div class="postdate"><a href="topic-post463.html#post463" name="post463" rel="nofollow">#6</a> 2009 年 10 月 26 日(月) 10:49</div>
			</td>
		</tr>
		<tr class="tr2">
			<td class="posterinfo">
				会員
				<div class="avatar"></div>
				<div class="field">登録者: 8 2009</div>
				<div class="field">返信数: 5</div>
				<div class="field"></div>
			</td>
			<td class="postcontent">
				<div class="post">yoshiyanさん、<br /><br /><blockquote class="quote"><div class="title">引用</div><div class="content">このHPっていつ迄公開していますか？？</div></blockquote><br />→answers/に入れてますので、削除予定は、ありません。<br /><blockquote class="quote"><div class="title">引用</div><div class="content">この公開されているSeverは、何でしょうか。？？</div></blockquote><br />→このサーバーは、どなたでも、登録すれば、すぐに、使えるようになる無償サーバーです。<br />（フリーメールアドでも、OKです）サーバーの中身については、@pagesの管理者へ、問い合わせてください。 <img src="./templates/phpgrjp0.3/smilies/wink.gif" alt=";)" /></div>
			</td>
		</tr>

		<tr class="tr1">
			<td class="postername">
				<div class="posternamecontainer"><a href="profile-291.html">yasu1988</a></div>
			</td>
			<td class="postinfo">
				<div class="postlinks"></div>
				<div class="postdate"><a href="topic-post493.html#post493" name="post493" rel="nofollow">#7</a> 2010 年 1 月 9 日(土) 9:42</div>
			</td>
		</tr>
		<tr class="tr1">
			<td class="posterinfo">
				会員
				<div class="avatar"></div>
				<div class="field">登録者: 1 2010</div>
				<div class="field">返信数: 7</div>
				<div class="field"></div>
			</td>
			<td class="postcontent">
				<div class="post">down.php側の末尾に<br />download_file(&#36;path_file);<br />を入れてはどうでしょうか。<br />これではただ関数を定義しているだけのようですが。<br /><br />&gt; /* ファイルを読んで出力 */<br />&gt; if (!readfile(&#36;path_file)) &#123;<br />&gt; die(&quot;Cannot read the file(&quot;.&#36;path_file.&quot;)&quot;);<br />&gt; &#125;<br />&gt; &#125;<br />download_file(&#36;path_file);// ←この行を追加<br />&gt; ?&gt;</div>
			</td>
		</tr>

	</table>
	<p id="toolbarbottom"> </p>
	<p id="pagelinksbottom">ページ: 1</p>
	<div id="bottomfix"></div>
	<p id="actionlinks"></p>

	<p class="locationbar">
		&bull; <a href="index.html">日本PHPユーザ会 掲示板</a> &raquo; <a href="forum-4.html">PHP 5</a> &raquo; 任意のファイルをダウロードするスクリプト
	</p>
	
	<p id="linkbar">
		<a href="members.html">会員一覧</a> &middot; <a href="members-staff.html">スタッフ一覧</a> &middot; <a href="rss.xml" id="rss-feed-icon"><img src="templates/phpgrjp0.3/gfx/rss.png" alt="RSS フィード" /></a><a href="rss.xml">RSS フィード</a>  &middot; <a href="mailto:webstaff@php.gr.jp">管理者へ連絡</a>
	</p>
	
	
	
	
	<p id="bottom">
		日本PHPユーザ会 掲示板 は <a href="http://www.usebb.net">UseBB 1 フォーラムソフトウェア</a> を使用しています
	</p>
	<div id="bottom-shadow"></div>
	
	</div>
	</div>
	</div>
</body>
</html>